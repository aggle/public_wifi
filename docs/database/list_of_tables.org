#+TITLE: List of Tables
#+AUTHOR: Jonathan Aguilar

This document contains a list of tables for the Tr14 database, and their descriptions.
They were assembled loosely (i.e. poorly) following the procedure laid out in [[https://learning.oreilly.com/library/view/database-design-for/9780133122282/ch07.html][Database Design for Mere Mortals, Ch. 7]].

* Preliminary Table List
** Procedure
*** Identify implied subjects
Review the [[./list_of_fields.org][List of Fields]]. If you can group some into a subject, add that subject to the preliminary tables list
*** Use the List of Subjects 
Merge the list of implied subjects with the list of subjects you made [[./list_of_subjects.org][here]].
** Tables
*** stars 
formerly known as Astrophysical objects table
**** star_id
unique identifier
**** u_mast, v_mast
u and v positions in the master frame of reference
**** star_phot_fi, star_phot_e_fi
Photometry (and uncertainty) in Filter Fi, where i is a label for the filter
**** star_cluster_memb
Does the star belong to the cluster (True) or the background (False)
*** Point sources table
A "point source" is the detection of an astrophysical object in a particular exposure
**** ps_id                                                            :PK:
unique id for the point source.
**** star_id                                                         :FK:
the astrophysical object it corresponds to.
**** ps_x_exp, ps_y_exp
x and y position for this particular exposure.
**** ps_phot, ps_phot_e
Photometry and uncertainty.
**** ps_filter_id
The filter used for the exposure.
**** ps_exp_id
The exposure the point source was found in.
*** Stamps table
Stamp ID and data quality
**** stamp_id
unique identifier for each stamp
**** ps_id
ID of the point source in the center of the stamp
**** star_id
ID of the astrophysical object in the center of the stamp (redundant)?
**** stamp_file
File name where the stamp is saved
**** good_ref_flag
Formerly "good_ref"
Flag for if this stamp can be used as a reference for PSF subtraction.
**** stamp_dq_flags
I think this should be its own subtable
***** maybe 1 field for every data quality flag
key is the name of the flag, and value is the number of pixels in the stamp that match that DQ flag
*** Filters table
This table keeps track of the name and ID of each filter in the observations
**** filter_id
A unique ID that can be incremented for an arbitrary number of filters
**** filter_name
HST name for a filter, e.g. "F139M"
*** Headers tables
These tables store the header information for each exposure/flt.fits file.
See documentation in the [[https://hst-docs.stsci.edu/wfc3dhb/chapter-2-wfc3-data-structure/2-2-wfc3-file-structure#id-2.2WFC3FileStructure-2.2.3ContentsofIndividualArrays][WFC3 Data Handbook]]. The fields are the header keywords, and the field values are the header keyword values
**** SCI
Science data - a.k.a. the flux-calibrated images, with counts in e/s
**** ERR
Estimate of the statistical uncertainty associated with each corresponding science image pixel
**** DQ
data quality headers. each pixel contains a bit word with data quality flags
**** SAMP
for IR data only, the number of samples used to derive the pixel values in the science image
**** TIME
for IR data only, effective integration time associated with each science image pixel
*** Stamp data quality table
This table contains the flag value, the binary code, and a short description of the meaning
*** Candidates table
Basically same data as point sources, but for the candidates.
**** comp_x_stamp, comp_y_stamp
x and y position in the stamp in the stamp's native orientation
This might need to be a subtable for multiple detections of the same companion
**** comp_phot, comp_phot_e
Photometry and uncertainty.
**** companion_id
unique identifier
**** parent_star_id
identifier for the parent star
**** stamp_ids
identifier for the stamps where the companion is found
**** sep, pa
separation and position angle with N up, E left
*** Subtraction table
This table stores the parameters used for a PSF subtraction
**** target_id
id for the target stamp
**** reference_id_i..n
ids for the reference stamps
**** psfsub_algo_name
name for the algorithm - in our case, KLIP. Maybe in future NNMF. maybe more specific, like software version?
**** psfsub_algo_params
This should probably be a subtable. Each field is the name of a parameter, and each value is the value of the parameter.
*** Reference matrix
This table aggregates (Yes/No) whether or not any particular stamp can be used as a reference for another stamp.
* Final Table List
Options for table type: data, linking, subset, or validation
** stars
*** Type
Data
*** Description
This table contains a list of all the unique stars that are identified in the observations. 
We need this table to keep track of which star each point source corresponds to, so that we can combine point source stamps to improve detection statistics during our analysis. Ultimately, the final science products will rely on interpretation of the distribution and properties of the astrophysical objects detected during our survey.
** point_sources
*** Type
Data
*** Description
This table contains every point source detected in every exposure taken during the observations. 
The point sources are important because they are the fundamental result of each *observation* and must be collected and combined for interpretation. Multiple point source detections of the same star can be combined for improved analysis. The master list of unique astrophysical objects is derived by transforming the list of point sources onto the plane of the sky and combining overlapping point sources.
** stamps
*** Type
Data
*** Description
This table keeps track of the stamps and their data quality flags. 
The image stamps are generated by selecting a stamp of pixels around each point source in the database. This table will contain summary statistics for all the data quality flags present in each pixel contained in the stamp, for help assessing if the information contained in the stamp is reliable.
** stamp_dq_flags
*** Type
Subset
*** Description
This is a subset table for stamps, that keeps track of all the data quality flags. This is important for selecting appropriate references/assessing data quality.
** filters
*** Type
Subset (or linking?)
*** Description
This table stores the names of the HST filters that correspond to the filter IDs
** headers
This set of tables contains all the header information from the exposures, except for the history and comments. These should be read-only.
*** hdr_sci
**** Type
data
**** Description
Science headers
*** hdr_err
**** Type
data
**** Description
error  headers
*** hdr_dq
**** Type
data
**** Description
data quality headers
*** hdr_samp
**** Type
data
**** Description
sampling headers
*** hdr_time
**** Type
data
**** Description
exposure time headers
** candidates
*** Type
Data
*** Description
This table contains the basic information for all candidates, such as the ID of the primary star, separation position angle. photometry, and the stamp(s) in which it was found.
** psf_subtractions
*** Type
Data
*** Description
This table stores the parameters used for PSF subtraction, like Kklips and reference stamp IDs
** reference_matrix
*** Type
Data
*** Description
This table keeps a list of which stamps meet the criteria to be PSF references for other stamps. Important quantities to consider are a stamp's own "good reference" flag, and the result of the image similarity computation between any two stamps.

* Tables and fields
Here we associate fields with each table
** stars
*** TODO star_id
**** General Elements
***** Field Name
      star_id
***** Parent Table
      stars
***** Label:
      none
***** Specification Type
      - [X] Unique
      - [ ] Generic
      - [ ] Replica
***** Source Specification
      none
***** Shared By
      List other tables that share this field here
***** Aliases
      List other names for this field here
***** Description
      This field is a unique identifier for an astrophysical object.
**** Physical Elements
***** Data Type
      alphanumeric
***** Length
      7
***** Decimal Places
      none
***** Character Support
      - [X] Letters (A-Z)
      - [X] Numbers (0-9)
      - [ ] Keyboard (.,/$#%)
      - [ ] Special
***** Input Mask
      none
***** Display Format
      S######

**** Logical Elements
***** Key Type
      - [ ] Non
      - [ ] Foreign
      - [X] Primary
      - [ ] Alternate
***** Key Structure
      - [X] Simple
      - [ ] Composite
***** Uniqueness
      - [ ] Non-unique
      - [X] Unique
***** Null Support
      - [ ] Nulls Allowed
      - [X] No Nulls
***** Values Entered By
      - [ ] User
      - [X] System
***** Required Value
      - [ ] No
      - [X] Yes
***** Default Value
      none
***** Range of Values
      R000000 - R999999
***** Edit Rule
      - [ ] Enter Now, Edits Allowed
      - [X] Enter Now, Edits Not Allowed
      - [ ] Enter Later, Edits Allowed
      - [ ] Enter Later, Edits Not Allowed
      - [ ] Not Determined At This Time
***** Comparisons Allowed
      - [-] Same Field
        - [ ] All
        - [X] =
        - [ ] >
        - [ ] >=
        - [X] !=
        - [ ] <
        - [ ] <=
      - [-] Other Fields
        - [ ] All
        - [X] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
      - [ ] Value Expression
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
***** Operations Allowed
      - [ ] Same Field
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
      - [ ] Other Fields
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
      - [ ] Value Expression
        + [ ] All
        + [ ] +
        + [ ] -
        + [ ] *
        + [ ] /
        + [ ] Concatenation
*** TODO u_mast
**** General Elements
***** Field Name
      Enter field name here
***** Parent Table
      Enter parent table here
***** Label:
      Enter label or shorter name here
***** Specification Type
      - [ ] Unique
      - [ ] Generic
      - [ ] Replica
***** Source Specification
      If /Specification Type/ is /Replica/, enter source field here
***** Shared By
      List other tables that share this field here
***** Aliases
      List other names for this field here
***** Description
      Describe the field here
**** Physical Elements
***** Data Type
      Enter data type here (alphanumeric, numeric, datetime)
***** Length
      Number of characters the field will hold
***** Decimal Places
      Enter number of decimal places here (can be all)
***** Character Support
      - [ ] Letters (A-Z)
      - [ ] Numbers (0-9)
      - [ ] Keyboard (.,/$#%)
      - [ ] Special
***** Input Mask
      Enter input mask here (the manner in which a user should enter the data)
***** Display Format
      Enter display format here

**** Logical Elements
***** Key Type
      - [ ] Non
      - [ ] Foreign
      - [ ] Primary
      - [ ] Alternate
***** Key Structure
      - [ ] Simple
      - [ ] Composite
***** Uniqueness
      - [ ] Non-unique
      - [ ] Unique
***** Null Support
      - [ ] Nulls Allowed
      - [ ] No Nulls
***** Values Entered By
      - [ ] User
      - [ ] System
***** Required Value
      - [ ] No
      - [ ] Yes
***** Default Value
      Enter default value here
***** Range of Values
      Enter range of allowed values here
***** Edit Rule
      - [ ] Enter Now, Edits Allowed
      - [ ] Enter Now, Edits Not Allowed
      - [ ] Enter Later, Edits Allowed
      - [ ] Enter Later, Edits Not Allowed
      - [ ] Not Determined At This Time
***** Comparisons Allowed
      - [ ] Same Field
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
      - [ ] Other Fields
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
      - [ ] Value Expression
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
***** Operations Allowed
      - [ ] Same Field
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
      - [ ] Other Fields
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
      - [ ] Value Expression
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
*** TODO v_mast
**** General Elements
***** Field Name
      Enter field name here
***** Parent Table
      Enter parent table here
***** Label:
      Enter label or shorter name here
***** Specification Type
      - [ ] Unique
      - [ ] Generic
      - [ ] Replica
***** Source Specification
      If /Specification Type/ is /Replica/, enter source field here
***** Shared By
      List other tables that share this field here
***** Aliases
      List other names for this field here
***** Description
      Describe the field here
**** Physical Elements
***** Data Type
      Enter data type here (alphanumeric, numeric, datetime)
***** Length
      Number of characters the field will hold
***** Decimal Places
      Enter number of decimal places here (can be all)
***** Character Support
      - [ ] Letters (A-Z)
      - [ ] Numbers (0-9)
      - [ ] Keyboard (.,/$#%)
      - [ ] Special
***** Input Mask
      Enter input mask here (the manner in which a user should enter the data)
***** Display Format
      Enter display format here

**** Logical Elements
***** Key Type
      - [ ] Non
      - [ ] Foreign
      - [ ] Primary
      - [ ] Alternate
***** Key Structure
      - [ ] Simple
      - [ ] Composite
***** Uniqueness
      - [ ] Non-unique
      - [ ] Unique
***** Null Support
      - [ ] Nulls Allowed
      - [ ] No Nulls
***** Values Entered By
      - [ ] User
      - [ ] System
***** Required Value
      - [ ] No
      - [ ] Yes
***** Default Value
      Enter default value here
***** Range of Values
      Enter range of allowed values here
***** Edit Rule
      - [ ] Enter Now, Edits Allowed
      - [ ] Enter Now, Edits Not Allowed
      - [ ] Enter Later, Edits Allowed
      - [ ] Enter Later, Edits Not Allowed
      - [ ] Not Determined At This Time
***** Comparisons Allowed
      - [ ] Same Field
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
      - [ ] Other Fields
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
      - [ ] Value Expression
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
***** Operations Allowed
      - [ ] Same Field
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
      - [ ] Other Fields
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
      - [ ] Value Expression
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
*** TODO star_phot_fi
**** General Elements
***** Field Name
      Enter field name here
***** Parent Table
      Enter parent table here
***** Label:
      Enter label or shorter name here
***** Specification Type
      - [ ] Unique
      - [ ] Generic
      - [ ] Replica
***** Source Specification
      If /Specification Type/ is /Replica/, enter source field here
***** Shared By
      List other tables that share this field here
***** Aliases
      List other names for this field here
***** Description
      Describe the field here
**** Physical Elements
***** Data Type
      Enter data type here (alphanumeric, numeric, datetime)
***** Length
      Number of characters the field will hold
***** Decimal Places
      Enter number of decimal places here (can be all)
***** Character Support
      - [ ] Letters (A-Z)
      - [ ] Numbers (0-9)
      - [ ] Keyboard (.,/$#%)
      - [ ] Special
***** Input Mask
      Enter input mask here (the manner in which a user should enter the data)
***** Display Format
      Enter display format here

**** Logical Elements
***** Key Type
      - [ ] Non
      - [ ] Foreign
      - [ ] Primary
      - [ ] Alternate
***** Key Structure
      - [ ] Simple
      - [ ] Composite
***** Uniqueness
      - [ ] Non-unique
      - [ ] Unique
***** Null Support
      - [ ] Nulls Allowed
      - [ ] No Nulls
***** Values Entered By
      - [ ] User
      - [ ] System
***** Required Value
      - [ ] No
      - [ ] Yes
***** Default Value
      Enter default value here
***** Range of Values
      Enter range of allowed values here
***** Edit Rule
      - [ ] Enter Now, Edits Allowed
      - [ ] Enter Now, Edits Not Allowed
      - [ ] Enter Later, Edits Allowed
      - [ ] Enter Later, Edits Not Allowed
      - [ ] Not Determined At This Time
***** Comparisons Allowed
      - [ ] Same Field
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
      - [ ] Other Fields
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
      - [ ] Value Expression
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
***** Operations Allowed
      - [ ] Same Field
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
      - [ ] Other Fields
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
      - [ ] Value Expression
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
*** TODO star_phot_e_fi
**** General Elements
***** Field Name
      Enter field name here
***** Parent Table
      Enter parent table here
***** Label:
      Enter label or shorter name here
***** Specification Type
      - [ ] Unique
      - [ ] Generic
      - [ ] Replica
***** Source Specification
      If /Specification Type/ is /Replica/, enter source field here
***** Shared By
      List other tables that share this field here
***** Aliases
      List other names for this field here
***** Description
      Describe the field here
**** Physical Elements
***** Data Type
      Enter data type here (alphanumeric, numeric, datetime)
***** Length
      Number of characters the field will hold
***** Decimal Places
      Enter number of decimal places here (can be all)
***** Character Support
      - [ ] Letters (A-Z)
      - [ ] Numbers (0-9)
      - [ ] Keyboard (.,/$#%)
      - [ ] Special
***** Input Mask
      Enter input mask here (the manner in which a user should enter the data)
***** Display Format
      Enter display format here

**** Logical Elements
***** Key Type
      - [ ] Non
      - [ ] Foreign
      - [ ] Primary
      - [ ] Alternate
***** Key Structure
      - [ ] Simple
      - [ ] Composite
***** Uniqueness
      - [ ] Non-unique
      - [ ] Unique
***** Null Support
      - [ ] Nulls Allowed
      - [ ] No Nulls
***** Values Entered By
      - [ ] User
      - [ ] System
***** Required Value
      - [ ] No
      - [ ] Yes
***** Default Value
      Enter default value here
***** Range of Values
      Enter range of allowed values here
***** Edit Rule
      - [ ] Enter Now, Edits Allowed
      - [ ] Enter Now, Edits Not Allowed
      - [ ] Enter Later, Edits Allowed
      - [ ] Enter Later, Edits Not Allowed
      - [ ] Not Determined At This Time
***** Comparisons Allowed
      - [ ] Same Field
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
      - [ ] Other Fields
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
      - [ ] Value Expression
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
***** Operations Allowed
      - [ ] Same Field
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
      - [ ] Other Fields
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
      - [ ] Value Expression
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
*** TODO star_clust_memb
**** General Elements
***** Field Name
      Enter field name here
***** Parent Table
      Enter parent table here
***** Label:
      Enter label or shorter name here
***** Specification Type
      - [ ] Unique
      - [ ] Generic
      - [ ] Replica
***** Source Specification
      If /Specification Type/ is /Replica/, enter source field here
***** Shared By
      List other tables that share this field here
***** Aliases
      List other names for this field here
***** Description
      Describe the field here
**** Physical Elements
***** Data Type
      Enter data type here (alphanumeric, numeric, datetime)
***** Length
      Number of characters the field will hold
***** Decimal Places
      Enter number of decimal places here (can be all)
***** Character Support
      - [ ] Letters (A-Z)
      - [ ] Numbers (0-9)
      - [ ] Keyboard (.,/$#%)
      - [ ] Special
***** Input Mask
      Enter input mask here (the manner in which a user should enter the data)
***** Display Format
      Enter display format here

**** Logical Elements
***** Key Type
      - [ ] Non
      - [ ] Foreign
      - [ ] Primary
      - [ ] Alternate
***** Key Structure
      - [ ] Simple
      - [ ] Composite
***** Uniqueness
      - [ ] Non-unique
      - [ ] Unique
***** Null Support
      - [ ] Nulls Allowed
      - [ ] No Nulls
***** Values Entered By
      - [ ] User
      - [ ] System
***** Required Value
      - [ ] No
      - [ ] Yes
***** Default Value
      Enter default value here
***** Range of Values
      Enter range of allowed values here
***** Edit Rule
      - [ ] Enter Now, Edits Allowed
      - [ ] Enter Now, Edits Not Allowed
      - [ ] Enter Later, Edits Allowed
      - [ ] Enter Later, Edits Not Allowed
      - [ ] Not Determined At This Time
***** Comparisons Allowed
      - [ ] Same Field
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
      - [ ] Other Fields
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
      - [ ] Value Expression
        - [ ] All
        - [ ] =
        - [ ] >
        - [ ] >=
        - [ ] !=
        - [ ] <
        - [ ] <=
***** Operations Allowed
      - [ ] Same Field
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
      - [ ] Other Fields
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
      - [ ] Value Expression
        - [ ] All
        - [ ] +
        - [ ] -
        - [ ] *
        - [ ] /
        - [ ] Concatenation
** point_sources
*** TODO ps_id
*** TODO ps_star_id
*** TODO ps_exp_id
*** TODO ps_filter_id
*** TODO ps_phot
*** TODO ps_phot_e
*** TODO ps_y_exp
*** TODO ps_x_exp

** candidates
** stamps
*** stamp_id
*** stamp_file
*** stamp_ref_flag

** stamp_dq_flags
| stamp_dq_flags      |
|---------------------|
| stamp_id            |
| stamp_dq_flag       |
| stamp_dq_flag_value |
** filters
| filters   |
+-----------+
| filt_id   |
| filt_name |
** headers
| headers  |
+----------|
| hdr_sci  |
| hdr_err  |
| hdr_dq   |
| hdr_samp |
| hdr_time |
** psf_subtractions
** allowed_references
